(function(){"use strict";var t={1580:function(t,e,n){var s=n(9963),i=n(6252);function o(t,e,n,s,o,r){const a=(0,i.up)("router-view");return(0,i.wg)(),(0,i.j4)(a)}var r={name:"App"},a=n(3744);const l=(0,a.Z)(r,[["render",o]]);var c=l,d=n(2201),u=n(3577),m=n.p+"img/spiner.2cca7d64.gif";const h=t=>((0,i.dD)("data-v-c13037ce"),t=t(),(0,i.Cn)(),t),f=h((()=>(0,i._)("h1",null,"Список статей",-1))),w=["disabled"],y={class:"forTable"},p=h((()=>(0,i._)("thead",null,[(0,i._)("tr",null,[(0,i._)("th",null,"№"),(0,i._)("th",null,"Автор"),(0,i._)("th",null,"Название"),(0,i._)("th",null,"Рейтинг"),(0,i._)("th",null,"Дата Публикации")])],-1)));function v(t,e,n,s,o,r){const a=(0,i.up)("router-link");return(0,i.wg)(),(0,i.iD)("div",null,[f,(0,i._)("button",{class:"refresh",onClick:e[0]||(e[0]=(...t)=>r.refreshStorise&&r.refreshStorise(...t)),disabled:o.isLoadedStories,title:"Обновить статьи"},null,8,w),(0,i._)("div",y,[(0,i._)("p",{style:(0,u.j5)({display:o.isLoadedFirstTime?"block":"none"})},"Количество загруженных статей: "+(0,u.zw)(o.countLoadedStories)+" из 100",5),(0,i._)("img",{src:m,style:(0,u.j5)({display:o.isLoadedFirstTime?"inline-block":"none"})},null,4),(0,i._)("table",{style:(0,u.j5)({display:o.isLoadedFirstTime?"none":"table"})},[p,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.stories,((t,e)=>((0,i.wg)(),(0,i.iD)("tr",{key:t.id},[(0,i._)("td",null,(0,u.zw)(e+1),1),(0,i._)("td",null,(0,u.zw)(t.by),1),(0,i._)("td",null,[(0,i.Wm)(a,{to:{name:"story",params:{id:t.id}},class:"linkToStory"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,u.zw)(t.title),1)])),_:2},1032,["to"])]),(0,i._)("td",null,(0,u.zw)(t.score),1),(0,i._)("td",null,(0,u.zw)(t.time),1)])))),128))],4)])])}n(7658);const _="https://hacker-news.firebaseio.com/v0/";let g=[];const k={getNewStories:"getNewStories",getStoryDetails:"getStoryDetails"};async function b(t){try{const e=await fetch(t);if(!e.ok)throw new Error("Произошла ошибка при загрузке данных");const n=await e.json();return n}catch(e){console.error("Произошла ошибка при загрузке данных:",e)}}function S(t,e,n,s,i){switch(t){case k.getNewStories:return`${_}newstories.json`;case k.getStoryDetails:return`${_}item/${e}.json`;default:throw new Error(`Unsopported method ${t}`)}}function C(t){const e=new Date(1e3*t);return e.toLocaleString("en-GB")}function L(t,e,n){let s='<div class="dot"></div>';s=s.repeat(n);const i=`<div class="nestedComments">\n                                        ${s}\n                                        <div class="comment">\n                                            <div class="forName">\n                                                <h4>${t.by}</h4>\n                                                <h4>${t.time}</h4>\n                                            </div>\n                                            <p>${t.text}</p>\n                                        </div>\n                                    </div>`,o=document.querySelector(`div.commentKid[data-id="${e}"]`);o.insertAdjacentHTML("beforeend",i)}async function j(t,e){const n=await b(S(k.getNewStories));return n.slice(t,e)}async function T(t){let e=await b(S(k.getStoryDetails,t));if(null!==e)return e.time=C(e.time),e}async function z(t){let e=await T(t);return e.kids?e.click=!0:e.click=!1,e}async function D(t,e,n=1){for(const s of t){let t=await T(s);L(t,e,n),t.kids&&await D(t.kids,e,n+1)}}function O(t){0!==g.length&&g[0].id==t[0].id||(g.length=0,g.push(...t))}function N(){return g}var $={name:"ListStories",data(){return{stories:[],limitStories:100,countLoadedStories:0,isLoadedStories:!1,isLoadedFirstTime:!1}},methods:{async refreshStorise(){this.isLoadedStories=!0,this.stories=await this.fetchNewStories(),O(this.stories),this.isLoadedStories=!1},async fetchNewStories(){this.countLoadedStories=0;const t=[],e=await j(0,this.limitStories);for(const n of e){const e=await T(n);null!=e&&(t.push(e),this.countLoadedStories++)}return t},async autoUpdate(){setInterval((async()=>{await this.refreshStorise()}),6e4)}},async mounted(){0===N().length?(this.isLoadedFirstTime=!0,await this.refreshStorise(),this.isLoadedFirstTime=!1,this.autoUpdate()):(this.stories.length=0,this.stories.push(...N()))}};const x=(0,a.Z)($,[["render",v],["__scopeId","data-v-c13037ce"]]);var F=x,H=n.p+"img/button-down.6e21fbf7.gif";const K={class:"story"},U=["href"],E={class:"commentsConteyner"},M={class:"commentHeader"},P=["disabled"],Y=["data-id"],Z=["onClick"],A={class:"comment"},B={class:"forName"},I=(0,i._)("img",{src:H},null,-1),W=["innerHTML"];function q(t,e,n,s,o,r){const a=(0,i.up)("router-link");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(a,{to:{name:"home"},class:"back"}),(0,i._)("div",K,[(0,i._)("h1",null,(0,u.zw)(o.story.title),1),(0,i._)("ul",null,[(0,i._)("li",null,[(0,i._)("a",{href:o.story.url,target:"_blank"},"Ссылка",8,U)]),(0,i._)("li",null,[(0,i._)("p",null,"Автор: "+(0,u.zw)(o.story.by),1)]),(0,i._)("li",null,[(0,i._)("p",null,"Дата публикации: "+(0,u.zw)(o.story.time),1)])])]),(0,i._)("div",E,[(0,i._)("div",M,[(0,i._)("h2",null,"Комментарии "+(0,u.zw)(o.story.descendants),1),(0,i._)("button",{class:"refresh",title:"Обновить комментарии",onClick:e[0]||(e[0]=(...t)=>r.refreshComments&&r.refreshComments(...t)),disabled:o.isLoadedComments},null,8,P)]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.comments,(t=>((0,i.wg)(),(0,i.iD)("div",{class:"commentsBlock",key:t.id},[(0,i._)("div",{class:"commentKid","data-id":t.id},[(0,i._)("div",{class:(0,u.C_)(["firstComment",{hasKids:t.click}]),onClick:e=>r.onClickComment(t.id)},[(0,i._)("div",A,[(0,i._)("div",B,[(0,i._)("h4",null,(0,u.zw)(t.by),1),I,(0,i._)("h4",null,(0,u.zw)(t.time),1)]),(0,i._)("p",{innerHTML:t.text},null,8,W)])],10,Z)],8,Y)])))),128)),(0,i._)("img",{src:m,style:(0,u.j5)({display:o.isLoadedComments?"inline-block":"none"})},null,4)])],64)}var G={name:"StoryView",data(){return{story:0,comments:[],isLoadedComments:!1}},methods:{async fetchNewComments(t){this.isLoadedComments=!0;let e=[];for(const n of t)e.push(await z(n));return this.isLoadedComments=!1,e},async onClickComment(t){const e=this.comments.find((e=>e.id===t));e.kids&&(e.click=!1,await D(e.kids,t))},async refreshComments(){this.comments.length=0,this.story=await T(this.story.id),this.story.descendants>0&&(this.comments=await this.fetchNewComments(this.story.kids))}},async mounted(){const t=N().find((t=>t.id==this.$route.params.id));t?(this.story=t,this.story.descendants>0&&(this.comments=await this.fetchNewComments(this.story.kids))):(console.log("Объект не найден"),this.$router.go(-1))}};const V=(0,a.Z)(G,[["render",q]]);var J=V;const Q=[{path:"/",name:"home",component:F},{path:"/story/:id",name:"story",component:J}],R=(0,d.p7)({history:(0,d.PO)("/testTask/"),routes:Q});var X=R;(0,s.ri)(c).use(X).mount("#app")}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,n),o.exports}n.m=t,function(){var t=[];n.O=function(e,s,i,o){if(!s){var r=1/0;for(d=0;d<t.length;d++){s=t[d][0],i=t[d][1],o=t[d][2];for(var a=!0,l=0;l<s.length;l++)(!1&o||r>=o)&&Object.keys(n.O).every((function(t){return n.O[t](s[l])}))?s.splice(l--,1):(a=!1,o<r&&(r=o));if(a){t.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[s,i,o]}}(),function(){n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.p="/testTask/"}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,s){var i,o,r=s[0],a=s[1],l=s[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var d=l(n)}for(e&&e(s);c<r.length;c++)o=r[c],n.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return n.O(d)},s=self["webpackChunktestrout"]=self["webpackChunktestrout"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(1580)}));s=n.O(s)})();
//# sourceMappingURL=app.a10dffdf.js.map